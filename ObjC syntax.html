<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>ObjC Syntax</title>
	<style>
	
		table
		{
			width: 100%;
		}
		td
		{
			width: 50%;
			border: solid 1px #eee;
			vertical-align: top;
		}
		#dump
		{
			font-size: 80%;
			white-space: pre;
			font-family: monaco;
		}
		textarea
		{
			width: 100%;
			height: 400px;
		}
		#transformed
		{
			font-size: 80%;
			white-space: pre;
			font-family: monaco;
			background-color: #eee;
		}
		.objc
		{
			color: blue;
			font-weight: bold;
		}
		.firstobjc
		{
			color: red;
		}
		.objcopener
		{
			color: lime;
		}
		.objccloser
		{
			color: orange;
		}
		
</style>
</head>
<body>
	<script src='crockford/fulljslintmod.js'></script>
	<script src='lintex.js'></script>
<table><tr><td>
<textarea estyle='display: none'>
		var a, b, p = [a, b]
		var o = [[NSObject alloc] init]
		[this performSelector:'hello' withObject:2*6/3-Math.round(6) afterDelay:'HOP']
		
		var c = [someObject doThis] + [someOtherObject handle1:[a1, d1] and2:b1]
		var d = a + c
		
		var chainedCall = [[NSObject alloc:'hello' and:'world'] initWithKey:[SomeKey someParam] andKey:[SomeOtherKey p1:'a' p2:'b']]
</textarea>
<div id='transformed'>
</div>
<td>
	<div id='dump'></div>
</table>

	<script>

			function	htmlEncode(str)
			{
//				return str
				return str.replace(/</g, '&lt;')
				return str.replace(/</g, '&lt;')
				return str.replace(/</g, '&lt;')
			}
			function	getTickCount()
			{
				return (new Date).getTime()
			}
			function	dumpHash(o)
			{
				var str = ''
				for (var i in o) str += i + '=' + (o[i]) + '\n'
				return str
			}
			function	dumpHashNoFunction(o)
			{
				var str = ''
				for (var i in o) { if (typeof o[i] == 'function') continue; str += i + '=' + (o[i].toString == 'toStringToken' in this ? ('*TOKEN*'+o[i].value + '*') : o[i]) + '\n' }
				return str
			}


		//
		// JSLint logging
		// 
		var tokens
		function	logToken(token)
		{
			tokens.push(token)
			dump.innerHTML += ' ' + token.value
//			alert(dumpHash(token))
			if (token.id == '(endline)') dump.innerHTML += '\n\n'
		}
		function	logStatement(statement)
		{
		}

		function	logParseStart(rbp, initial)
		{
			
		}
		function	logParseEnd(rbp, initial)
		{
			
		}

		function	logFunctionStart(startToken)
		{
			functionLines.push(startToken.line)
		}
		function	logFunctionEnd(startToken, endToken)
		{
		}
		
		function	logObjCStart()
		{
			dump.innerHTML += '\n***OBJC***'
		}
		
		//
		// Dump tokens
		// 
		function	dumpTokens()
		{
			var str = ''
			var str2 = ''
			for (var i=0; i<tokens.length; i++)
			{
				var token = tokens[i]
				var v = token.value
				if (token.isObjCCall) v = '<span class="objc">' + token.value + '</span>'
				if (token.isFirstObjCCall) v = '<span class="firstobjc">' + token.value + '</span>'
				if (token.isObjCCallOpener) v = '<span class="objcopener">' + token.value + '</span>'
				if (token.isObjCCallCloser) v = '<span class="objccloser">' + token.value + '</span>'
				
				str += ' ' + v
				//			alert(dumpHash(token))
				if (token.id == '(endline)') str += '\n\n'
			}
			dump.innerHTML = getTickCount() + '\n' + str
			transformed.innerHTML = getTickCount() + '\n' + str2
		}


		//
		// 
		// 
		var dump = document.getElementById('dump')
		var transformed = document.getElementById('transformed')
		
		var textarea = document.getElementsByTagName('TEXTAREA')[0]

		function	lint()
		{
			var src = textarea.value
			var lines = src.split('\n')
		
			dump.innerHTML = getTickCount()

			tokens = []
			var options = { forin : true, laxbreak : true, indent : true }
			var lintRes = JSLINT(lines, options)
		
			var str = 'tree=' + lintRes
			if (JSLINT.errors) JSLINT.errors.pop()
			for (var i=0; i<JSLINT.errors.length; i++)
			{
				var e = JSLINT.errors[i]
				str += '\n' + dumpHash(e)
			}
			dump.innerHTML += '<hr>' + str
			
			dumpTokens()
		}
		lint()
		
		function	keyup()
		{
			setTimeout(lint, 0)
		}
		textarea.onkeyup = keyup

	</script>

<pre>	
	[[NSObject alloc]]
	-> un immediate de [NSObject.alloc()]

</body>
</html>
